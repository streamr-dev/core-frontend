import ScrollableAnchor from 'react-scrollable-anchor'
import cx from 'classnames'
import { Link } from 'react-router-dom'

import CodeSnippet from '$shared/components/CodeSnippet'
import { CreateStreamButton } from '$userpages/components/StreamPage/List'
import { formatPath } from '$shared/utils/url'
import links from '$shared/../links'

import ProductPage from '$mp/containers/ProductPage'

import CreateStreamDialog from './images/createStreamDialog.png'
import EditStreamDetails from './images/editStreamDetails.png'
import MyFirstStreamViewPage from './images/myFirstStreamViewPage.png'
import ConfigureMyFirstStream from './images/configureMyFirstStream.png'
import CSVConfig from './images/CSVConfig.png'
import DropCSVHere from './images/dropCSVHere.png'
import SampleTwitterData from './images/sampleTwitterData.png'
import TwitterStreamView from './images/twitterStreamView.png'
import SubscribingToStream from './images/subscribingToStream.png'

import docsStyles from '../DocsLayout/docsLayout.pcss'
import localStyles from './visualEditorPage.pcss'

# Visual Editor

<ScrollableAnchor id="introduction"><div>

## Introduction

Streamr is a cloud-based platform for creating and managing microservices that process events in real-time data streams.  It abstracts the complexity of the underlying stream processing technology and provides a user-friendly front end, saving you time and money along the way.

There’s many things you can do with Streamr. For instance, you’ll be able to monitor real-time industrial processes, ingest and visualise sensory data from IoT devices, calculate streaming analytics, follow and act on high-frequency financial market data, take automatic action when abnormal patterns are detected, extract information from social media traffic, track customer payments, orders, or deliveries, and automate various business processes. If you have a source of real-time data and you want to do useful things with it, Streamr is for you.

Streamr makes it easy to set up digital microservices for handling real-time data. In Streamr, such microservices are called **canvases**. There is a browser-based visual programming interface where you can quickly put a canvas together using modular building blocks. You can also code all or part of a canvas in Java if that's what you prefer. Streamr supports abstraction, and you'll be able to re-use  code and custom modules as your code base grows.

The platform is flexible and fast. Event streams can contain any kind of data in any format. The technology can handle millions of events per second and it copes with a practically unlimited number of live services in parallel. The underlying software runs (by default) in the cloud. Additional computing capacity is deployed automatically when required.

The development environment includes a playback mode where you can simulate the processing logic over days, weeks, months, or years of data over billions of events if needed. When you’re happy, you can launch your canvas live at a click of a button. In the live mode, a Streamr canvas listens to real-time events, processes the data, and takes the required action.

The secret sauce of Streamr is the hidden technology which makes creating and managing real-time microservices easy. Apart from the browser-based user interface and visual programming tools, Streamr takes care of the data flow, event propagation, message queues, load balancing, and other technical issues under the hood. It also manages your live canvases and stores the full event history on your behalf.

### Data live in streams

All real-time data in Streamr is stored in [streams](#streams). A stream is essentially a timestamped sequence of events. Each event may contain more than one field. You can create and work on dozens, hundreds, or thousands of streams. A stream is persistent, identified by a unique ID, and stored in the cloud.

Any kind of real-time data can be stored in a stream. The incoming data may consist of sensory readings of speed, geolocation, orientation, ambient temperature, humidity, and so forth. Or the data may contain social media messages, stock market events, mobile ad impressions, and so on.

There is no limit on the kind, format, or quantity of the data you feed into Streamr. The data may originate from machines on the factory floor, sensors in a smart city, in-house databases or systems, or from commercial streaming data feeds.

There are a few different ways to get data into a stream. Streamr has a simple HTTP API which allows you to push events in JSON format to a stream from any programming language. You can also batch load historical events using Streamr’s CSV loader. If the events originate in a database or in a third-party data feed, talk to us. We'll figure out what kind of adapter is needed.

Streams implement a publish-subscribe paradigm, or pub/sub for short. A stream can receive data from many sources (or publishers), and there can be several listeners who subscribe to a stream. There are several variations on the possible pub/sub topologies, such as many-to-one, one-to-many, or many-to-many.  Streamr supports all of these.

### Turn the data into action

You can build any kind of automatic real-time functionality with Streamr [canvases](#canvases) (i.e. microservices). We make it easy to create and manage your digital workforce. There is an extensive collection of built-in [modules](#modules) as a source of building blocks. You can abstract modules and re-use them later, and you can code custom modules in Java.

Here's a few examples of specific things you can do.

- Refine real-time data by routing it through different modules. The built-in module library includes arithmetic and logical operations. There are also functions for smoothing, sampling, and aggregating streaming data.
- Chain modules together so that the output from one operation flows as an input to another. This is one way to build arbitrarily complex streaming analytics. If you want to keep things tidy, you can encapsulate the complexity and reuse the abstracted result.
- Visualise the data by directing it to a charting module. The chart shows the new data in real-time as new events arrive or streaming analytics are computed.
- Communicate with the outside world by sending text messages or emails when specific conditions are satisfied. You can embed real-time data, refined data, or natural language in the messages.
- Save refined data in another stream. When you do that, the saved data are instantly accessible as new events. The refined data can be streamed from the platform to external data consumers.
- Post events in HTTP format to external RESTful services. There's a wide range of popular and useful services out there, and you can use any one of them easily from Streamr. 
- Control external devices. As an example, you can override manual controls and make a remotely operated drone return to base when it's about to go out of range or running low on battery. Because the control interface is likely to be machine specific, this is one case where you'd be looking at coding a custom module in Java.

Although we sometimes find it hard to admit, there's life outside Streamr. We're not jealous, though, and indeed make it easy to spread the word. Here's what you can do:

- Create dashboards which display live data sourced from Streamr.
- Embed live visualisation elements in external web pages by inserting a single line of HTML code.
- Subscribe to a stream in external web pages and applications. You'll receive every event as soon as it’s available.

### Who is Streamr for?

The short answer is that Streamr is for anyone who wants to create new, interesting, and valuable things on top of real-time data, and wants to do it quickly and with minimum fuss.

Streamr offers value to many different user groups. Domain experts and R&D teams can use Streamr for quick prototyping and exploration before building a production level offering. Streamr gives students, hobbyists, and enthusiasts a fully functional but affordable event processing platform in the cloud.

For corporations and organisations, Streamr is a tool for sharing and teamwork. The real-time data that you collect may be a treasure trove for innovation, but nothing will happen unless the data is available and usable. Streamr can be the spark which makes innovation happen: It brings the data into the open, and makes it easy to experiment with ideas for new products and services.

</div></ScrollableAnchor>
<ScrollableAnchor id="streams"><div>

# Streams

All data in Streamr is stored in a stream. A stream is simply a sequence of events in time. You can add new data to the end of a stream, and a stream will give the data back to you in the correct order. 

You can store different kinds of data in the same stream.  The data may be numeric, but it can equally well consist of strings, collections of elementary data types, or associative arrays. Each event contains at least one data field, but you can have as many fields per event as required. The data are persistent and stored in the cloud.

The raison d'être for a stream is its capability to provide real-time inputs to Streamr [canvases](#canvases), and act as a recipient of real-time output from such canvases. You can also use a stream as a pub/sub-device, push data into it, and subscribe to the data elsewhere. 

In this chapter, we’ll show stream examples and describe the built-in data types. We'll then discuss how to do the following:

- Create or delete a stream.
- Edit stream details.
- Upload historical data.
- Push events to a stream.
- Subscribe to a stream.

### Stream examples

Here’s an example of what a small part of a stream could look like. Each row shows one event, and the columns correspond to the timestamp followed by two data fields: A measurement of the operating temperature and the number of rotations per minute (RPM).

Timestamp               | Temperature | RPM
:---------------------- |:------------|:----
2016-02-01 11:30:01.012 | 312.56      | 3550
2016-02-01 11:30:02.239 | 312.49      | 3549
2016-02-01 11:30:04.105 | 312.42      | 3543
2016-02-01 11:30:08.122 | 313.21      | 3565
2016-02-01 11:30:11.882 | 317.45      | 3602
...                     |             |

As an example of a more complicated event, here’s a data point in a stock market stream.

<CodeSnippet language='javascript' wrapLines>{
`{
    "Symbol": "PFFT",
    "EventType": 1,
    "OrderId": 6454321,
    "Direction": "Up",
    "Trade": {"Price": 118.55, "Size": 100},
    "Ask": [
            {"Price": 118.6, "Size": 22500},
            {"Price": 118.65, "Size": 18000},
            {"Price": 118.7, "Size": 13000},
            {"Price": 118.8, "Size": 8000},
            {"Price": 119, "Size": 45000}
            ],
    "Bid": [
            {"Price": 118.5, "Size": 16500},
            {"Price": 118.45, "Size": 11000},
            {"Price": 118.4, "Size": 14200},
            {"Price": 118.2, "Size": 19000},
            {"Price": 118, "Size": 50000}
           ]
}`
}</CodeSnippet>

### Working with streams

You can create new streams either manually in the user interface or by using the <Link to={formatPath(links.docs.api)}>API</Link>. Each stream is identified by a unique ID. There’s no technical limit on the total number of streams.

If you want to create a stream manually, go to the <kbd>Streams</kbd> tab.  There’s a button which looks like this:

<div className={docsStyles.centered}>
  <CreateStreamButton />
</div>

A click takes you to a dialog where you’ll fill in the stream name and an optional description.

<div className={cx(docsStyles.centered, localStyles.createStreamDialog)}>
  <img src={CreateStreamDialog} />
</div>

A new stream is created when you click the **Next** button.  You’ll be shown a stream view that includes the stream details (the name and description), API credentials, configured fields (there won’t be any yet), and a summary of stream history (there will be none yet). 


<div className={docsStyles.centered}>
  <img src={MyFirstStreamViewPage} />
</div>

If you want to delete a stream, first click on its name, and then click on the **Delete stream** button. You’ll be asked to confirm that you really want to go ahead. You can also delete a stream using the <Link to={formatPath(links.docs.api)}>API</Link>.

In order to read the stream from external applications using the HTTP API, you need to create <strong>Anonymous keys</strong> not bound to specific Streamr user. This way you can grant (and revoke) external applications and users the access to your stream. Choose a descriptive <strong>Key name</strong> (e.g. name of the external application, client, or customer you want to grant the access), select <strong>can read</strong> from the dropdown, and hit <strong>+</strong>. Copy the key to clipboard by clicking the copy icon. Revoke the access by clicking the trash bin icon.

In order to push data into the stream from external sources using the HTTP API, or let external application push data into your data stream, you need to create an anonymous key with <i>write permissions</i>. Choose a descriptive <strong>Key name</strong> (e.g. name of the external data producer), select <strong>can write</strong> from the dropdown, and hit <strong>+</strong>. For details on how to implement the data sender, see <a href="#pushing-events-section">Pushing events to a stream</a>.

<div className={docsStyles.centered}>
  <img src={EditStreamDetails} />
</div>

If you want to edit stream details, you need to be in the <kbd>Streams</kbd> tab. Click on the stream name, and then click on the **Edit info** button. You'll see a dialog where you can rename a stream or modify its description.

### EditStreamDetails

The stream view also includes the option of configuring the data fields.  If you’ll load real-time data through the API, you’ll need to configure the data fields now.  If you’ll first load historical data from a text file, you can skip this step.  We’ll be in many cases able to to autodetect the field types from the input.

If you want to configure the data fields manually, the Configure Fields button takes you to a setup dialog.  To add a new data field, click on the **+ Add Field** button, give the field a name and change the field type as appropriate.  Remember to save the changes when done.

<div className={docsStyles.centered}>
  <img src={ConfigureMyFirstStream} />
</div>

You can also rename a stream, edit the description, add data fields and specify the field types using the <Link to={formatPath(links.docs.api)}>API</Link>.

### Uploading historical data

Batches of historical events can be loaded into a stream by importing a CSV file. You need to be in the <kbd>Streams</kbd> tab to do this. When you click on an existing stream, you’ll see a History panel and a data drop.  This is where you can drop a text file with a batch of event history.

<div className={docsStyles.centered}>
  <img src={DropCSVHere} />
</div>

You can also pick a local file for import by manually by clicking on the data drop.  Either way, Streamr will parse the given CSV file and load the events into the stream.

As to the format, the CSV file should have the column names on the first row, and use either a comma or a semicolon as the separator.  One of the columns should be a timestamp, where the recommended format is either `"yyyy-MM-dd HH:mm:ss"` or `"yyyy-MM-dd HH:mm:ss.SSS”`.  Timestamps must be in a chronological order with earlier events first and the recent events last.

If Streamr cannot find the event timestamps or doesn’t understand the timestamp format, you will see a dialog box like the one below.  This is where you can manually select the timestamp column and specify the format.

<div className={docsStyles.centered}>
  <img src={CSVConfig} />
</div>

We’ll do our best to make sense of the data columns in the CSV file, but the autodetection of field types will not always work.  For instance, a column of telephone numbers may be interpreted as numbers even if you’d probably want to import them as strings.  In such cases, you’ll need to configure the fields manually as shown above.  Mind you, making changes that don’t make sense will cause runtime exceptions due to incompatible data types.

Let’s go ahead and upload some sample data.  We’ll import a text file which contains a collection of recent tweets found with the keywords `“augmented intelligence”`.  This is what the sample tweet data looks like, as at the time of writing, with only four columns and a subset of rows shown:

<div className={docsStyles.centered}>
  <img src={SampleTwitterData} />
</div>

The data file is called `“SampleTweets.csv”`, and you can download the latest version to your desktop from this [link](“SampleTweets.csv”) **TODO FIX THIS**. 

If you drag the the sample file to the data drop, the events are uploaded to the stream.  Once the process is complete, the stream view is updated to show the extent of the archived history. 

<div className={docsStyles.centered}>
  <img src={TwitterStreamView} />
</div>

### Built-in data types

There’s a number of built-in data types that can be used in a stream. These are the following:

- **Number**: A numeric data type internally stored as a double precision (64-bit) float.

- **Boolean**: A logical data type with two possible values, True and False.

- **String**: A sequence of zero or more alphabetical characters.

- **Map**: A collection of key-value pairs.

- **List**: An ordered collection of zero or more elements.

Map is the same as a dictionary or an associative array found in a number of programming languages. Each key is a string, and the value can be of any built-in data type (even a Map again).

Data types can be freely mixed in one event. And you can freely add new fields to an existing stream; you don’t have to know what fields you might eventually need. A single event can be of any size within reason, and a stream can grow indefinitely when extended by new events. 

There is no theoretical limitation as to the format or type of data in Streamr. Anything which can be expressed in digital form is fair game. It is perfectly possible to create streams which contain digital images, streaming video, or other domain-specific data. If your use case takes you beyond the built-in data types, come and talk to us about what you have in mind.

### Pushing events to a stream

Streamr has a simple <Link to={formatPath(links.docs.api)}>API</Link> which allows you to push events in JSON format to a stream. The events are immediately delivered to subscribers of the stream, including canvases which use the stream as well as any external applications listening to the stream via the API.

You can push events to a stream from any programming language, and there are also convenient client libraries for some languages. For details and usage examples please see the <Link to={formatPath(links.docs.api)}>API Documentation</Link>.

Instead of using the API, you can produce events to streams on a canvas using the SendToStream module. This is highly useful when you refine data using a canvas and want to produce the results to another stream.

## Subscribing to a stream

Subscribing to streams in order to use the data on canvases is trivially easy: just add the stream to a canvas. As a simple taster of how this works, here's a stream of social media messages connected to a **Table** module.

<div className={docsStyles.centered}>
  <img src={SubscribingToStream} />
</div>

You can also subscribe to a stream in any external application via our [API](https://api-explorer.streamr.com).

</div></ScrollableAnchor>
<ScrollableAnchor id="modules"><div>

## Modules

</div></ScrollableAnchor>

<ScrollableAnchor id="canvases"><div>

## Canvases

</div></ScrollableAnchor>
<ScrollableAnchor id="extensions"><div>

## Extensions

</div></ScrollableAnchor>
