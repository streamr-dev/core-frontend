language: node_js
node_js:
- '8'
sudo: true
branches:
  only:
  - master
  - development
  - beta
  - "/^v\\d+\\.\\d+(\\.\\d+)?(-\\S*)?$/"
before_install:
- pip install awscli --upgrade --user
- npm config set //registry.npmjs.org/:_authToken=$NPM_TOKEN
- npm i -g npm@^6.9.0
- cd app
install:
- npm ci
- true
cache:
  directories:
  - "$HOME/.npm"
env:
  global:
  - secure: g/km642SU0HZoBmYIkt3gsWoXonuXYN4rdYfXm2ynavMKyojbDLHM+EYLB1uk1vsGR8SITHTQaE1lBoSlgD9aTXzyhtnDp3VkWJAm3/sxQIE8HEoKRT+4odrV/DCoidMLmeIL0xqLSYc2u+fLKm6dMnEdOVwBRPMPSdx6EMfusEbv2fPBMbWNTSEk5Jd8ppR1QwpbJQomeSp9uhxIH8pQWYUD3/zmhl26xYZ93wJMDQXoNyCQhlfpL7IcTljWPI+LP/U7GgSjBON/NHQ7Ka0Pq2UIA9B0QfrMPMrqOHb8AG2P/RaUyBqu0Jay6sdpyrJxJpANv7OAPE4RhLgjJx9fK4qzBvV6dwqxFt+1sNQRZCHc3AL5P7QiE4uVahbfy7i0xq1/aoJPLkIUEwnGn1HD1TBYE4LDnukkkFqN/GCuMBor2rqJLobRYlOY6g+EFfaCrG1gKfqVFr98XxJbBbTV8fRdyiqiJzpXtTLVpxJL2KDNdnhrTI+l5+/wRsiROu3rv2d5V0W25qOhhE02IxHAyfDb63dhddBopxO0TyjE5v7yew6HbpukixSDap7dq+w/P6m0Z7MjrAc+tMUOW/36TGVcLdK1pdEl1heVhNA9KVfzFT3nUP9nua/9weScISusQdhw6+GZrRyFQSfAJqaUemyJbyl0VFuxcVIt+fVNLQ=
  - secure: hu5cpsMinQEpoNgnJv1XQ+509/57gM4dHg+mRXaAkZ7ha6k0AK1AmNgsCKYfs2G8Qe3eFGM3DTuJA0JV9vOcUeHNURGQKW+ukciSN1dT8dmLC6DAjgd89LIV5jsgAMBtNNCeIDwdpSEhe39nD4P1ligVpxxtY9kbOfK+F/cNbgj9ZpC/MZ55rniMa1JkZpfWwP3bdOcko56E+dB3/Dh8L0QF1hiDA1AwpGXQcO2jQ22HvTyUIezcgIYGGSUJ0N9gPhe7f0UQ4iCdMbq2rKv2wi4vzKQPFOkK8eYAUfhbv1iHy/bP2VX8tR7ac9XJuAznaHJ3tng8iEnvF5ForiaAVhtUNOUi1Hw0i2qdaoash0hJh3Aq8IwyFZiZYAQYmIC29VuoPQJgTPVECEDkzqs8fbC0nqwjG9aVP6OkGUgSmR9LChUVsF8ZfLAp/R4bY0XJh6vuqG00qfl90f2zooTA/HPQa7D2VJBEDretZLR0u1ufPHEPkl++o5MeaeNn98KYKOD66fqK+lHf1fmyBogRRefXFZFOi1zNgZTe+xA6nNHk9eAMvYf9CfIsRM7AVnBviTWBkx3S5KDcbof8rdyUymwu5T/7Hly6JZmYKLZ5esQHoV2J5LYOxeaZoXXLARgQkxdpf/9sxNVkkB8TW6llnk+Bd7o7Qn9to80m60X2zsQ=
  - secure: "dD7Qx3V2Emwc00/cxAmQzjR85NQ9k+ViHqABGLf8W0CzfOOekCjSTfZbqZoaodeTXkPExKgxT3C3eFa2k0RUMlo2eA7jGheDeDVybtcSYfNlbzEvu8qlAF+0qvlrSRpOFvOoUo1ItjeXmnbkRbe2460Vw/dgPWz7Km6tTiApxg52+fncCgctC3VsyqBMZ9ojYea1iK7hBUN0oa/+cy6OFcAzN9OkDjgWtsymushuQSRl0ePQMHOR+HxbOsUKlaYh0Dd2aoX5oeq1SWvSipEcvwyJs5O7aCySn/WQ73FVkuilB3E/BPyGBMovIx+s7qMvGoBPlQVurgR2/MJPoWVmDe62OiziMf6f8nx/AXDD720JODWVJSIli/rZu/Z2yWD+jZ2JZMLoxsya/j5DmjjoCWj+qpAMdZCFLANKBCMbuF9xZxWOzlFbHjIa9hEeU9DqlCRJKsXzt1keNxEn3YRQKWnT5S8ICCC6aBSNAtqI4ZaVYSeJaS8fxnms4GzdNF7cDGHW1it+cuq1FpGS4yRcxAz7xo+Ql1zTnaFeWNO1bneONx5o4fg/4kZ+njPCEFXo0FSU09SW83dX0L0+VD5k2afWVO/AhlLZ2EI5F6WyZreIUGFyMeTPs6AR82UnMSjLY1z3TEMl5eAUYLJOvry94QpjqoND8JCOVGXF60dq/tA="
  - SENTRY_ORG=streamr
  - SENTRY_PROJECT=marketplace
jobs:
  include:
  - stage: Platform Tests
    if: type IN (pull_request)
    env:
    - DESCRIPTION=UNIT_TEST
    - STREAMR_API_URL=http://localhost:8081/streamr-core/api/v1
    - STREAMR_WS_URL=ws://localhost:8890/api/v1/ws
    - STREAMR_URL=http://localhost:8081/streamr-core
    - PLATFORM_ORIGIN_URL=http://localhost
    - VERSION="$TRAVIS_PULL_REQUEST_BRANCH"
    - VERSION2=$TRAVIS_PULL_REQUEST_BRANCH
    script: env
